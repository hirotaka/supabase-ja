---
id: vercel
title: 'Vercel'
description: Supabaseを使用したアプリケーションを立ち上げるには、VercelのNext.jsスターターとSupabaseのインテグレーション（統合）が最も早い方法です。
---

このガイドでは、Vercelのダッシュボードを使って、Supabaseと統合されたNext.jsプロジェクトを作成する手順を説明します。Next.jsのスターター・テンプレートを使用することで、ダッシュボードから離れることなく、自動的にGitHubの新しいリポジトリにフォークできます。

Vercelのアカウントをお持ちでない方は、[こちら](https://vercel.com/signup)でアカウントを作成してください。

## ステップ1：Supabaseプロジェクトを作成

このガイドでは既存のSupabaseプロジェクトを使用できましたが、スクラッチから`todo`デモを作成します。まず、[Supabase](https://app.supabase.com/)に移動します。`Sign In`をクリックし、GitHubで認証してログインするか、新しいアカウントを登録します。

Supabaseダッシュボードから`New project`をクリックし、組織（organization）を選択します。

> 注：最初に組織を作成する必要がある場合もあります。

プロジェクトに`name`（名前）と`password`（パスワード）を付け、潜在的なユーザーに近い`region`（地域）を選択し、`Create new project`をクリックします。

![Create a Supabase project](/img/guides/integrations/vercel/create-supabase-project.png)

Supabaseはインフラストラクチャを設定するのに数分かかります。

設定が完了したら、サイドバーメニューの`SQL Editor`を開き、`New query`をクリックします。

すると、`New query`という名前の新しいSQLスニペットが作成されます。以下のコードをコピー＆ペーストし、`Run`をクリックします。

```sql
create table todos (
  id bigint generated by default as identity primary key,
  title text,
  is_complete boolean default false,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

alter table todos enable row level security;

create policy "Anyone can view todos" on todos for
    select using (true);

create policy "Anyone can add new todos" on todos for
    insert with check (true);

insert into todos(title)
values
  ('Create Supabase project'),
  ('Create Vercel project'),
  ('Install Supabase integration');
```

これにより、新しいtodosテーブルが作成され、行単位セキュリティーが有効になります。データの選択と挿入のためのポリシーが追加され、いくつかのサンプルの行が追加されます。

> 注：この例では簡単にするために、誰でも`todos`テーブルの行を`select`や`insert`できるようにしています。通常、これらの操作は、ログインしたユーザーのみが実行できるようにします。行単位セキュリティーとポリシーの詳細については、[こちらのビデオ](https://www.youtube.com/watch?v=Ow_Uzedfohk)をご覧ください。

## ステップ2：Vercelプロジェクトを作成

[Vercelダッシュボード](https://vercel.com/dashboard)から`New Project`をクリックします。

![Create new Vercel project](/img/guides/integrations/vercel/create-vercel-project.png)

`Clone Template`メニューで`Next.js`をクリックします。

![Clone Next.js template](/img/guides/integrations/vercel/clone-next-js-template.png)

`Create Git Repository`セクションで、`GitHub`をクリックします。`GIT SCOPE`でユーザー名を選択し、プロジェクトの名前を入力します。レポジトリーを`private`（プライベート）にするか、`public`（パブリック）にするかを選択して、`Create`をクリックします。

![New GitHub repo settings](/img/guides/integrations/vercel/repo-settings.png)

これで新しいGitHubリポジトリーが作成され、Next.jsのスターターのプロジェクトがクローンされてコミットされます。それから、新しいプロジェクトがビルドされてVercelにデプロイされます。

`Congratulations`画面にリダイレクトされたら、`Go to Dashboard`をクリックします。

`Settings`から`Integrations`に移動し、`Browse Marketplace`をクリックします。

`Supabase`を検索し、Supabaseのインテグレーションをクリックします。

![Supabase integration](/img/guides/integrations/vercel/supabase-integration.png)

`Add Integration`をクリックします。`Vercel Scope`のドロップダウンからアカウントを選択し、`CONTINUE`をクリックします。

![Choose scope](/img/guides/integrations/vercel/choose-scope.png)

`Specific Projects`を選択し、ドロップダウンから新しいVercelプロジェクトを選択して、`Add Integration`をクリックします。

![Choose project](/img/guides/integrations/vercel/choose-project.png)

Supabaseポップアップのドロップダウンから新しいVercelプロジェクトとSupabaseプロジェクトを選択します。

![Supabase integration](/img/guides/integrations/vercel/link-vercel-to-supabase.png)

<<<<<<< HEAD
## ステップ4：GitHubリポジトリをクローン
=======
## Step 3: Clone GitHub repo
>>>>>>> 6df13042f42d2844cb5c34b96fe5ca84995c301c

このプロジェクトをローカルで実行するには、Vercelが作成したリポジトリをクローンするのが一番早い方法です。

Vercelプロジェクトの`Overview`ページに戻り、`View Git Repository`をクリックします。

![Vercel Project Dashboard](/img/guides/integrations/vercel/vercel-project-dashboard.png)

すると、GitHubリポジトリーが開きます。ここで、`Code`の隣にある矢印をクリックし、ドロップダウンからURLをコピーします。

![GitHub repo url](/img/guides/integrations/vercel/github-project-url.png)

ターミナルウィンドウまたはCLIを開き、以下のコマンドを実行してGitHubリポジトリーをクローンします。

```bash
git clone your-repo-url.git
```

お好みのコードエディターでプロジェクトを開き、`pages/index.js`の内容を以下のように更新します。

```jsx
import styles from '../styles/Home.module.css'

export default function Home() {
  return <div className={styles.container}>working</div>
}
```

ローカルの開発サーバーを起動します。

```bash
npm run dev
```

`http://localhost:3000`にアクセスして、プロジェクトが動作することを確認します。

## ステップ4：Vercelから環境変数を引き出す

まず、VercelのCLIツールを使ってVercelにログインする必要があります。

```bash
npx vercel login
```

すると、`Vercel`をインストールしてもいいか尋ねられます。`y`と入力して`Enter`を押します。

次に、`Continue with GitHub`を選択してVercelを認証する必要があります。

すると、ブラウザウィンドウが開き、GitHubアカウントで認証します。

次に、Vercelプロジェクトをリンクします。

```bash
npx vercel link
```

画面の指示に従って、Vercelプロジェクトをリンクします。

![Link project from Vercel](/img/guides/integrations/vercel/vercel-link.png)

環境変数をVercelプロジェクトからコピーします。

```bash
npx vercel env pull
```

Supabaseの環境変数を含む`.env`ファイルが作成されます。このファイルの名前を`.env.local`に変更し、gitから自動的に無視するようにします。

## ステップ5：Supabase.jsをインストール

`supabase-js`ライブラリをインストールします。

```bash
npm i @supabase/supabase-js
```

`/utils/supabase.js`という新しいファイルを作成し、以下の内容を追加します。

```jsx
import { createClient } from '@supabase/supabase-js'

export default createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY
)
```

`/components/NewTodo.js`という新しいファイルを作成し、次の内容を追加します。

```jsx
import { useState } from 'react'
import supabase from '../utils/supabase'

export default ({ reload }) => {
  const [title, setTitle] = useState('')

  const addTodo = async (e) => {
    e.preventDefault()
    await supabase.from('todos').insert({ title })
    reload()
    setTitle('')
  }

  return (
    <form onSubmit={addTodo}>
      <input value={title} onChange={(e) => setTitle(e.target.value)} />
    </form>
  )
}
```

このコンポーネントは、Supabaseに新しい`todo`を書き込む役割を果たします。

`pages/index.js`に新しいコンポーネントをインポートして、Todoのリストを表示してみましょう。

```jsx
import { useState, useEffect } from 'react'
import styles from '../styles/Home.module.css'
import supabase from '../utils/supabase'
import NewTodo from '../components/NewTodo'

export default function Home() {
  const [todos, setTodos] = useState([])

  const fetchTodos = async () => {
    const { data } = await supabase.from('todos').select('*')
    setTodos(data)
  }

  useEffect(() => {
    fetchTodos()
  }, [])

  return (
    <div className={styles.container}>
      <NewTodo reload={fetchTodos} />
      {todos.map((todo) => (
        <p key={todo.id}>{todo.title}</p>
      ))}
    </div>
  )
}
```

## リソース

- [Vercel公式サイト](https://vercel.com)
- [Vercelブログ](https://vercel.com/blog)
- [Vercelドキュメント](https://vercel.com/docs)
- [Vercelインテグレーションのドキュメント](https://vercel.com/docs/integrations)
