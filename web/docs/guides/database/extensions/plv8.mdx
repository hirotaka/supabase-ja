---
id: plv8
title: "plv8：JavaScript言語"
description: PostgreSQLのためのJavaScript言語。
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

`plv8`拡張は、Postgres内でJavaScriptを使用できるようにします。

## 概要

PostgresはネイティブでSQLを実行しますが、他の「手続き型言語」も実行できます。`plv8`はJavaScriptのコード、特に[V8 JavaScriptエンジン](https://v8.dev)上で実行されるコードを実行できます。

これは、データベース関数、トリガ、クエリなどに使用できます。

## 使用方法

<<<<<<< HEAD

### 有効化
=======
### Enable the extension
>>>>>>> 2b7629b308417531d9d3e419f6ed55255dca1b23

<Tabs
  defaultValue="dashboard"
  values={[
    {label: 'Dashboard', value: 'dashboard'},
    {label: 'SQL', value: 'sql'},
  ]}>

<<<<<<< HEAD
```sh
1. 「Database」ページに移動します。
2. サイドバーの「Extensions」をクリックします。
3. 「plv8」を探します。
4. トグルをクリックします。
```
=======
<TabItem value="dashboard">

1. Go to the [Database](https://app.supabase.com/project/_/database/tables) page in the Dashboard.
2. Click on **Extensions** in the sidebar.
3. Search for "plv8" and enable the extension.
>>>>>>> 2b7629b308417531d9d3e419f6ed55255dca1b23

</TabItem>
<TabItem value="sql">

<<<<<<< HEAD
-- 例：「plv8」拡張を有効にする 
=======
```sql
-- Example: enable the "plv8" extension 
>>>>>>> 2b7629b308417531d9d3e419f6ed55255dca1b23
create extension plv8;

-- 例：「plv8」拡張を無効にする 
drop extension if exists plv8;
```

<<<<<<< HEAD
SQLコードが`create extension`（拡張を作成）になっていますが、「拡張を有効にする」ことと同じです。
拡張を無効にするには、`drop extension`を呼びだします。
=======
Even though the SQL code is `create extension`, this is the equivalent of "enabling the extension". 
To disable an extension, call `drop extension`.
>>>>>>> 2b7629b308417531d9d3e419f6ed55255dca1b23

手続き型言語は、`pg_catalog`に自動的にインストールされるので、スキーマを指定する必要はありません。

</TabItem>
</Tabs>

<<<<<<< HEAD
### `plv8`関数の作成
=======
### Create `plv8` functions
>>>>>>> 2b7629b308417531d9d3e419f6ed55255dca1b23

`plv8`で書かれた関数は、他のPostgreSQL関数と同じように書けますが、`language`識別子は`plv8`に設定します。

```sql
create or replace function function_name() 
returns void as $$
    // V8 JavaScript
    // code
    // here
$$ language plv8;
```

他のPostgres関数と同様に`plv8`関数を呼びだすことができます。

<Tabs
  defaultValue="sql"
  values={[
    {label: 'SQL', value: 'sql'},
    {label: 'JavaScript', value: 'javascript'},
  ]}>

<TabItem value="sql">

```sql
select function_name();
```

</TabItem>
<TabItem value="javascript">

```js
const { data, error } = supabase.rpc('function_name')
```

</TabItem>
</Tabs>

## 例

<<<<<<< HEAD
### スカラー関数
=======
### Scalar functions
>>>>>>> 2b7629b308417531d9d3e419f6ed55255dca1b23

[スカラー関数](https://plv8.github.io/#scalar-function-calls)とは、ユーザーの入力を受け取り、1つの結果を返すものです。

```sql
create or replace function hello_world(name text) 
returns text as $$

    let output = `Hello, ${name}!`;
    return output;

$$ language plv8;
```

### SQLの実行

[`plv8.execute`関数](https://plv8.github.io/#plv8-execute)を使って、`plv8`のコード内でSQLを実行できます。

```sql
create or replace function update_user(id bigint, first_name text) 
returns smallint as $$

    var num_affected = plv8.execute(
        'update profiles set first_name = $1 where id = $2', 
        [first_name, id]
    );

    return num_affected;
$$ language plv8;
```

<<<<<<< HEAD
### セット・リターン関数
=======
### Set-returning functions
>>>>>>> 2b7629b308417531d9d3e419f6ed55255dca1b23

[セット・リターン関数](https://plv8.github.io/#set-returning-function-calls)とは、テーブルにある複数の行のような、結果の一式を返す関数です。

```sql
create or replace function get_messages() 
returns setof messages as $$

    var json_result = plv8.execute(
        'select * from messages'
    );

    return json_result;
$$ language plv8;
```

<<<<<<< HEAD

## リソース

- 公式の[`pl8`ドキュメント](https://plv8.github.io/)
- [plv8のGitHubリポジトリ](https://github.com/plv8/plv8)
=======
## Resources 

- Official [`plv8` documentation](https://plv8.github.io/)
- [plv8 GitHub Repository](https://github.com/plv8/plv8)
>>>>>>> 2b7629b308417531d9d3e419f6ed55255dca1b23
