---
id: storage
<<<<<<< HEAD
title: ストレージ
description: ファイルの保存と提供にSupabaseを使用します。
=======
title: Storage
description: Use Supabase to store and serve files.
sidebar_label: Overview
>>>>>>> 1edd8856e6602ccea7e688a3b066792a2c72fccf
---

import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

## 概要

Supabase Storageは、大容量のファイルを簡単に保存して利用できます。

### ファイル

ファイルには、あらゆる種類のメディア・ファイルが含まれます。これには、画像、GIF、ビデオなどが含まれます。ファイルはサイズが大きいので、データベースの外に保存するのがよいでしょう。

### フォルダー

フォルダーは、ファイルを整理するための方法です（自分のコンピューターと同じです）。
ファイルの整理方法には、正解や不正解もありません。自分のプロジェクトに合ったフォルダー構成でファイルを保存できます。

### バケット

バケットとは、ファイルやフォルダーを入れる独立した容器のことです。一般的には、セキュリティールールやアクセスルールごとに異なるバケットを作成します。例えば、すべてのパブリックなファイルは「public（パブリック）」バケットに入れ、ログインしてアクセスする必要のあるファイルは「restricted（制限された）」バケットに入れるといった具合です。

## はじめに

これはSupabase Storageの基本的な機能を示すクイック・ガイドです。デプロイできる完全な[GitHubのサンプルアプリケーション](https://github.com/supabase/supabase/edit/master/examples/nextjs-ts-user-management)をご覧ください。

**Note はじめるまえに** : ファイル名、フォルダー名、バケット名は、必ず[AWSのセーフ文字のガイドライン](https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-keys.html)に従い、他の文字の使用は避けてください。

<<<<<<< HEAD
[![Vercelにデプロイ](https://vercel.com/button)](https://vercel.com/new/git/external?repository-url=https%3A%2F%2Fgithub.com%2Fsupabase%2Fsupabase%2Ftree%2Fmaster%2Fexamples%2Fnextjs-ts-user-management&project-name=supabase-user-management&repository-name=supabase-user-management&demo-title=Supabase%20User%20Management&demo-description=An%20example%20web%20app%20using%20Supabase%20and%20Next.js&demo-url=https%3A%2F%2Fsupabase-nextjs-ts-user-management.vercel.app&demo-image=https%3A%2F%2Fi.imgur.com%2FZ3HkQqe.png&integration-ids=oac_jUduyjQgOyzev1fjrW83NYOv&external-id=nextjs-user-management)
=======
[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/git/external?repository-url=https%3A%2F%2Fgithub.com%2Fsupabase%2Fsupabase%2Ftree%2Fmaster%2Fexamples%2Fuser-management%2Fnextjs-ts-user-management&project-name=supabase-user-management&repository-name=supabase-user-management&demo-title=Supabase%20User%20Management&demo-description=An%20example%20web%20app%20using%20Supabase%20and%20Next.js&demo-url=https%3A%2F%2Fsupabase-nextjs-ts-user-management.vercel.app&demo-image=https%3A%2F%2Fi.imgur.com%2FZ3HkQqe.png&integration-ids=oac_jUduyjQgOyzev1fjrW83NYOv&external-id=nextjs-user-management)
>>>>>>> 1edd8856e6602ccea7e688a3b066792a2c72fccf

### バケットを作成

Supabaseダッシュボードを使ってバケットを作成できます。
ストレージはPostgresデータベースと相互運用性がありますので、SQLやクライアントライブラリーを使用できます。ここでは「avatars」というバケットを作成します。

<Tabs
  groupId="storage-tabs"
  defaultValue="dashboard"
  values={[
    {label: 'Dashboard', value: 'dashboard'},
    {label: 'SQL', value: 'sql'},
    {label: 'JavaScript', value: 'javascript'},
    {label: 'Dart', value: 'dart'},
  ]}>
<TabItem value="dashboard">

<<<<<<< HEAD
```sh
1. 「Storage」セクションに移動します。
2. 「Create Bucket」をクリックします。
3. バケット名を入力します。
4. 「Create Bucket」をクリックします。
```
=======
1. Go to the [Storage](https://app.supabase.com/project/_/storage/buckets) page in the Dashboard.
2. Click **New Bucket** and enter a name for the bucket.
3. Click **Create Bucket**.
>>>>>>> 1edd8856e6602ccea7e688a3b066792a2c72fccf

<video width="99%" muted playsInline controls="true">
  <source src="/docs/videos/storage/create.mp4" type="video/mp4" muted playsInline />
</video>

</TabItem>
<TabItem value="sql">

```sql
-- Potgresを使ってバケットを作成します。

insert into storage.buckets (id, name)
values ('avatars', 'avatars');
```

</TabItem>
<TabItem value="javascript">

```js
// JSライブラリを使ってバケットを作成します。

const { data, error } = await supabase.storage.createBucket('avatars')
```

[リファレンス](/docs/reference/javascript/storage-createbucket)

</TabItem>
<TabItem value="dart">

```dart
void main() async {
  final client = SupabaseClient('supabaseUrl', 'supabaseKey');

  final storageResponse = await client
      .storage
      .createBucket('avatars');
}
```

[リファレンス](https://pub.dev/documentation/storage_client/latest/storage_client/SupabaseStorageClient/createBucket.html)

</TabItem>
</Tabs>

### ファイルをアップロード

ファイルのアップロードは、ダッシュボードからでも、JSライブラリーを使ってブラウザー内からでも可能です。

<Tabs
  groupId="storage-tabs"
  defaultValue="dashboard"
  values={[
    {label: 'Dashboard', value: 'dashboard'},
    {label: 'JavaScript', value: 'javascript'},
    {label: 'Dart', value: 'dart'},
  ]}>
<TabItem value="dashboard">

<<<<<<< HEAD
```sh
1. 「Storage」セクションに移動します。
2. ファイルをアップロードしたいバケットを選択します。
3. 「Upload File」をクリックします。
4. 表示されるダイアログで、アップロードしたいファイルを選択します。
```
=======
1. Go to the [Storage](https://app.supabase.com/project/_/storage/buckets) page in the Dashboard.
2. Select the bucket you want to upload the file to.
3. Click **Upload File**.
4. Select the file you want to upload.
>>>>>>> 1edd8856e6602ccea7e688a3b066792a2c72fccf

<video width="99%" muted playsInline controls="true">
  <source src="/docs/videos/storage/upload.mp4" type="video/mp4" muted playsInline />
</video>

</TabItem>
<TabItem value="javascript">

```js
const avatarFile = event.target.files[0]
const { data, error } = await supabase.storage
  .from('avatars')
  .upload('public/avatar1.png', avatarFile)
```

[リファレンス](/docs/reference/javascript/storage-from-upload)

</TabItem>
<TabItem value="dart">

```dart
void main() async {
  final client = SupabaseClient('supabaseUrl', 'supabaseKey');

  // Create file `example.txt` and upload it in `public` bucket
  final file = File('example.txt');
  file.writeAsStringSync('File content');
  final storageResponse = await client
      .storage
      .from('public')
      .upload('example.txt', file);
}
```

</TabItem>
</Tabs>

### ファイルをダウンロード

ファイルのダウンロードは、ダッシュボードからでも、JSライブラリーを使ってブラウザー内からでも可能です。

<Tabs
  groupId="storage-tabs"
  defaultValue="dashboard"
  values={[
    {label: 'Dashboard', value: 'dashboard'},
    {label: 'JavaScript', value: 'javascript'},
    {label: 'Dart', value: 'dart'},
  ]}>
<TabItem value="dashboard">

<<<<<<< HEAD
```sh
1. 「Storage」セクションに移動します。
2. ファイルが入っているバケットを選択します。
3. ダウンロードしたいファイルを選択します。
4. 「Download」ボタンをクリックします。
```
=======
1. Go to the [Storage](https://app.supabase.com/project/_/storage/buckets) page in the Dashboard.
2. Select the bucket that contains the file.
3. Select the file that you want to download.
4. Click **Download**.
>>>>>>> 1edd8856e6602ccea7e688a3b066792a2c72fccf

<video width="99%" muted playsInline controls="true">
  <source src="/docs/videos/storage/download.mp4" type="video/mp4" muted playsInline />
</video>

</TabItem>
<TabItem value="javascript">

```js
// JSライブラリを使用して、バケットを作成します。

const { data, error } = await supabase.storage.from('avatars').download('public/avatar1.png')
```

[リファレンス](/docs/reference/javascript/storage-from-download)

</TabItem>
<TabItem value="dart">

```dart
void main() async {
  final client = SupabaseClient('supabaseUrl', 'supabaseKey');

  final storageResponse = await client
      .storage
      .from('public')
      .download('example.txt');
}
```

</TabItem>
</Tabs>

### セキュリティールールの追加

ファイルへのアクセスを制限するには、ダッシュボードまたはSQLを使用します。

<Tabs
  groupId="storage-tabs"
  defaultValue="dashboard"
  values={[
    {label: 'Dashboard', value: 'dashboard'},
    {label: 'SQL', value: 'sql'}
  ]}>
<TabItem value="dashboard">

<<<<<<< HEAD
```sh
1. 「Storage」セクションに移動します。
2. サイドバーの「Policy」をクリックします。
3. 「OBJECTS」テーブルの「Add Policies」をクリックすると、ファイルのポリシーが追加されます。また、バケットのポリシーも作成できます。
4. ポリシーを、ダウンロード（SELECT）、アップロード（INSERT）、アップデート（UPDATE）、削除（DELETE）のいずれに適用するかを選択します。
5. ポリシーにはユニークな名前をつけます。
6. SQLを使ってポリシーを書きます。
```
=======
1. Go to the [Storage](https://app.supabase.com/project/_/storage/buckets) page in the Dashboard.
2. Click **Policies** in the sidebar.
3. Click **Add Policies** in the `OBJECTS` table to add policies for Files. You can also create policies for Buckets.
4. Choose whether you want the policy to apply to downloads (SELECT), uploads (INSERT), updates (UPDATE), or deletes (DELETE).
5. Give your policy a unique name.
6. Write the policy using SQL.
>>>>>>> 1edd8856e6602ccea7e688a3b066792a2c72fccf

<video width="99%" muted playsInline controls="true">
  <source src="/docs/videos/storage/policies.mp4" type="video/mp4" muted playsInline />
</video>

</TabItem>
<TabItem value="sql">

```sql
<<<<<<< HEAD
-- SQLを使ってポリシーを作成します。
=======
-- Use SQL to create a policy.
>>>>>>> 1edd8856e6602ccea7e688a3b066792a2c72fccf

create policy "Public Access"
  on storage.objects for select
  using ( bucket_id = 'public' );
```

</TabItem>
</Tabs>

## ヘルパー

Supabase Storageには、データベースのクエリやポリシーで使用できるデータベースSQLヘルパー関数が設定されています。

---

#### `storage.filename()`

ファイルの名前を返します。

```sql
select storage.filename(name)
from storage.objects;
```

例えば、ファイルが`public/subfolder/avatar.png`に格納されている場合、次のように返されます。

`'avatar.png'`

---

#### `storage.foldername()`

ファイルが属するすべてのサブフォルダーをパスの配列で返します。

```sql
select storage.foldername(name)
from storage.objects;
```

例えば、ファイルが`public/subfolder/avatar.png`に格納されている場合、次のように返されます。

`[ 'public', 'subfolder' ]`

---

#### `storage.extension()`

ファイルの拡張子を返します。

```sql
select storage.extension(name)
from storage.objects;
```

例えば、ファイルが`public/subfolder/avatar.png`に格納されている場合、次のように返されます。

`'png'`

---

## オブジェクトへのアクセス

プライベートなバケットの場合、[download](/docs/reference/javascript/storage-from-download)メソッドでオブジェクトにアクセスできます。これは`/object/auth/` APIエンドポイントに対応します。あるいは、[createSignedUrl](/docs/reference/javascript/storage-from-createsignedurl)メソッドを使って、有効期限のあるパブリックに共有可能なURLを作成できます。このメソッドは、`/object/sign/` APIを呼び出します。
また、`/object/sign/` APIを呼びだす[createSignedUrl](/docs/reference/javascript/storage-from-createsignedurl)メソッドを使用して、有効期限付きの公開用URLを作成可能です。

パブリックなバケットでは、トークンやAuthorisationヘッダーなしでアセットに直接アクセスできます。[getPublicUrl](/docs/reference/javascript/storage-from-getpublicurl)ヘルパーメソッドは、アセットの完全なパブリックURLを返します。これは、`/object/public/` APIエンドポイントを内部的に呼び出します。


<details> 
<summary>上級向け：リバース・プロキシ</summary>
返されるURLは、APIプロキシを経由してプロキシされたものです。これらのURLには<code>/storage/v1</code>というプレフィックスが付きます。

例えば、ホストされたプラットフォームでは、以下のようになります。

<code>https://[project_ref].supabase.co/ストレージ/v1/object/public/[id]</code>

同じエンドポイントを使用して、Storage APIに直接アクセスできます。利用できる操作の一覧は、<a href="https://supabase.github.io/storage-api">APIドキュメント</a>を参照してください。

</details>


---

## セキュリティー

Supabase Storageは、[Postgresデータベース](/docs/guides/database)と統合されています。つまり、ファイルへのアクセスを管理するために、同じ[ポリシー](/docs/guides/auth#policies)エンジンを使用できるのです。

## ポリシーの例

ここでは、PostgreSQLの行単位セキュリティーの威力を示す例を紹介します。各ポリシーはテーブルに添付され、テーブルがアクセスされるたびにポリシーが実行されます。

### バケットへのパブリックなアクセスを許可する

```sql
-- 1. 「public（パブリック）」バケット内のすべてのファイルへのアクセスを許可
create policy "Public Access"
on storage.objects for select
using ( bucket_id = 'public' );
```

### ログイン状態でのバケットへのアクセスを許可

```sql
-- 1. 「restricted（制限付き）」バケット内のすべてのファイルへのログインした状態でのアクセスを許可
create policy "Restricted Access"
on storage.objects for select
using (
  bucket_id = 'restricted'
  and auth.role() = 'authenticated'
);
```

### ファイルへの個別のアクセスを許可

```sql
-- 1. ユーザーが自分のファイルにアクセスできるようにする
create policy "Individual user Access"
on storage.objects for select
using ( auth.uid() = owner );
```

<<<<<<< HEAD
## リソース

- GitHubでAPIサーバーを参照：[github.com/supabase/storage-api](https://github.com/supabase/storage-api)
- Swagger API Docsをオンラインで参照：[supabase.github.io/storage-api](https://supabase.github.io/storage-api)
- 公式クライアントライブラリーのドキュメント：[JavaScript](/docs/reference/javascript/storage-createbucket)と[Dart](/docs/reference/dart/storage-createbucket)
- コミュニティーによるライブラリー：[github.com/supabase-community](https://github.com/supabase-community)

## 次のステップ

- 何か質問がありしたら、[こちら](https://github.com/supabase/supabase/discussions)で質問してください
- ストレージの詳細は[ブログ記事](https://supabase.com/blog/2021/03/30/supabase-storage)を参照してください
- サインイン：[app.supabase.com](https://app.supabase.com)
=======
## See also

- Read more about Supabase Storage in the [blog post](https://supabase.com/blog/supabase-storage)
- [Supabase Storage on GitHub](https://github.com/supabase/storage-api)
- [Swagger API documentation](https://supabase.github.io/storage-api)
- Official [JavaScript](/docs/reference/javascript/storage-createbucket) and [Dart](/docs/reference/dart/storage-createbucket) documentation
- [Community libraries](https://github.com/supabase-community)
>>>>>>> 1edd8856e6602ccea7e688a3b066792a2c72fccf
