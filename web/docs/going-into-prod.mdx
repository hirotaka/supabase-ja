---
id: going-into-prod
title: 本番稼働前のチェックリスト
description: 'アプリを公開する前にするべきこと'
---

プロジェクトの開発が終わり、実際のユーザーに公開する時が来たと判断したら、プロジェクトが次のチェックリストを満たしているか確認しましょう。

- 安全性
- 予想される負荷への耐久性
- サービスを提供し続けられるかの可用性

## セキュリティー

- RLSを有効にしていることを確認します。
    - 妥当なポリシーでRLSを有効にしていないテーブルでは、すべてのクライアントがデータにアクセスして変更できます。これは、ほとんどのケースで期待する挙動ではないことでしょう。
    - RLSの詳細は[こちら](/docs/guides/auth/row-level-security)を参照してください。
- 機密データを含んだテーブルのレプリケーションを有効にしている場合、行単位セキュリティー（RLS）を有効にし、行セキュリティー・ポリシーを設定します。
    - Supabaseダッシュボードの「Authetication」→「Poilicies」ページでRLSを有効にし、セキュリティポリシーを作成します。
    - Supabaseダッシュボードの「Database」→「Replication」ページでレプリケーション・テーブルを管理します。
- GitHubで2FA（2段階認証）を有効化
    - GitHubアカウントにはSupabaseプロジェクトの管理者権限が与えられているため、強力なパスワードとU2FキーやTOTPアプリを使った2FAで保護する必要があります。
- 「Auth」→「Settings」ページでメール確認が有効になっていることを確認します。
- 認証メールにカスタムSMTPサーバーを使用します。信頼できるドメインからメールが来ていることをユーザーが確認できるようにします（SendGrid、AWS SESなどの主要なメールプロバイダーからSMTP認証情報を取得してください）。メールサーバのドメインはアプリがホストされているのと同じドメインが望ましいです。
- 自分が攻撃者としたら、どのようにサービスを悪用するかをよく考え、対策を検討しましょう。
- これらの[一般的なサイバーセキュリティ上の脅威](https://auth0.com/docs/security/prevent-threats)を確認します。

## パフォーマンス

- 一般的なクエリパターンに対応する適切なインデックスを張っていることを確認します。
    - Postgresのインデックスの詳細は[こちら](https://www.enterprisedb.com/postgres-tutorials/overview-postgresql-indexes)を参照してください。
    - pg_stat_statementsは、[ホットまたはスローなクエリを特定](https://www.virtual-dba.com/blog/postgresql-performance-identifying-hot-and-slow-queries/)するのに役立ちます。
- 負荷テストの実施（できればステージング環境で）
    - [k6](https://k6.io/)のようなツールを使用すると、多くの異なるユーザーからのトラフィックをシミュレートできます。
- より多くのリソースが必要な場合は、support@supabase.ioに連絡して、より大きなサーバーのPAYG（使った分だけ支払う方式）にアップグレードしてください。

## 可用性

- 独自のSMTP認証情報を使用することで、認証メール送信の到達性を完全に制御できます（Auth → Settingsを参照）。
    - SMTP認証情報は、SendGridやAWS SESなどの主要なメールプロバイダーから取得できます。
    - Supabaseが提供する認証メールのデフォルトの制限値は、1時間あたり30人の新規ユーザーですが、大規模な公開する場合は、これ以上の数が必要になる可能性があります。
- アプリケーションをFree tier（無料版）でご利用し、少なくとも7日に1回の問い合わせが**ない**と判断された場合、Supabaseはサーバーのリソースを節約するためにアプリケーションを一時停止します。
    - 一時停止されたプロジェクトは、Supabaseのダッシュボードから復元できます。
    - Proにアップグレードすると、活動していないことを理由にプロジェクトが一時停止されることはありません。
- Free tierでは、データベースのバックアップをダウンロードできません。
    - [pg_dump](https://www.postgresqltutorial.com/postgresql-backup-database/)や[wal-g](https://github.com/wal-g/wal-g)などのツールを使って自身でバックアップシステムを構築できます。
    - Pro Tier（プロ版）プロジェクトの夜間バックアップは、Supabaseのダッシュボードで最大7日間利用可能です。
- Supabase Pro Tierにアップグレードすると、support@supabase.ioでのメールによるサポートを受けることができます。

このチェックリストは常に成長していますので、頻繁にチェックしてください。また、追加や修正を提案する場合は、[GitHub](https://github.com/supabase/supabase)にPRを作成してください。
